@page "/genre/{Id:int}"
@attribute [StreamRendering]
@using Microsoft.Extensions.Localization
@using Microsoft.Extensions.Options
@using PCRadio.DataAccess.Interfaces
@using PCRadio.DataAccess.Models
@using PCRadio.Services.Interfaces
@inject IStringLocalizer<Genre> localizer
@inject IStations stations
@inject IOptions<AppSettings> options
@inject IGenres genres
@inject IAppStateService appStateService

<PCRadio.Components.Controls.StationsList Count="@_result?.TotalCount" PageSize="@PageSize"
    Stations="@_result?.Stations.ToList()"
    GetStations="@(async (skip, take) => await stations.GetByGenreAsync(Id, skip, take))" />

@code
{
    private int PageSize => options.Value.PageSize;
    [Parameter]
    public int Id { get; set; }
    private StationsResult? _result = default!;

    protected override async Task OnParametersSetAsync()
    {
        _result = await stations.GetByGenreAsync(Id, 0, PageSize);
        appStateService.Title = $"{genres.GetById(Id)?.Name} ({_result?.TotalCount ?? 0})";
        await base.OnParametersSetAsync();
    }
}