@page "/"
@attribute [StreamRendering]
@using Microsoft.Extensions.Localization
@using Microsoft.Extensions.Options
@using PCRadio.DataAccess.Interfaces
@using PCRadio.DataAccess.Models
@using PCRadio.Services.Interfaces
@inject IStringLocalizer<Home> localizer
@inject IOptions<AppSettings> options
@inject IStations stations
@inject IAppStateService appStateService

<PCRadio.Components.Controls.StationsList Count="@_result?.TotalCount" PageSize="@PageSize"
    Stations="@_result?.Stations.ToList()" GetStations="@((skip, take) => stations.GetRecommendedAsync(skip, take))" />

@code
{
    private int PageSize => options.Value.PageSize;
    private StationsResult? _result = default!;

    protected override async Task OnParametersSetAsync()
    {
        _result = await stations.GetRecommendedAsync(0, PageSize);
        appStateService.Title = $"{localizer["Header"]} ({_result?.TotalCount ?? 0})";
        await base.OnParametersSetAsync();
    }
}